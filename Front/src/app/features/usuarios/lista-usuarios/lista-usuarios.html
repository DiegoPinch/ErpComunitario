<div class="bg-white rounded-lg shadow-md p-6">
    <p-toast></p-toast>
    <p-confirmDialog></p-confirmDialog>
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-800">Gestión de Usuarios</h1>
        <p-button label="Nuevo Usuario" icon="pi pi-plus" severity="info" (click)="openNew()"></p-button>
    </div>

    <app-custom-table [data]="(users$ | async) || []" [columns]="cols" title="Listado General" [showIndex]="true"
        [globalFilterFields]="['national_id', 'first_name', 'last_name', 'email']" [actions]="actions">
    </app-custom-table>

    <!-- Modal de Usuario -->
    <p-dialog [(visible)]="displayDialog" [header]="dialogTitle" [modal]="true" [style]="{ width: '50vw' }"
        [breakpoints]="{ '960px': '75vw', '640px': '90vw' }">

        <form [formGroup]="userForm" (ngSubmit)="saveUser()" class="flex flex-col gap-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Cédula -->
                <div class="flex flex-col gap-2">
                    <label for="national_id" class="font-semibold text-gray-700">Cédula</label>
                    <input pInputText id="national_id" formControlName="national_id" placeholder="Ej: 1712345678" />
                    <small
                        *ngIf="userForm.get('national_id')?.errors?.['required'] && userForm.get('national_id')?.touched"
                        class="text-red-500 block">
                        La cédula es requerida.
                    </small>
                    <small *ngIf="(userForm.get('national_id')?.errors?.['invalidCedulaLength'] || 
                                   userForm.get('national_id')?.errors?.['invalidCedulaRegion'] || 
                                   userForm.get('national_id')?.errors?.['invalidCedulaThirdDigit'] || 
                                   userForm.get('national_id')?.errors?.['invalidCedulaChecksum'] || 
                                   userForm.get('national_id')?.errors?.['invalidCedulaRepeated']) && 
                                   userForm.get('national_id')?.touched" class="text-red-500 block">
                        Cédula inválida.
                    </small>
                </div>

                <!-- Email -->
                <div class="flex flex-col gap-2">
                    <label for="email" class="font-semibold text-gray-700">Email</label>
                    <input pInputText id="email" formControlName="email" placeholder="correo@ejemplo.com" />
                    <small *ngIf="userForm.get('email')?.invalid && userForm.get('email')?.touched"
                        class="text-red-500">
                        Email inválido.
                    </small>
                </div>

                <!-- Nombres -->
                <div class="flex flex-col gap-2">
                    <label for="first_name" class="font-semibold text-gray-700">Nombres</label>
                    <input pInputText id="first_name" formControlName="first_name" class="uppercase" />
                    <small *ngIf="userForm.get('first_name')?.invalid && userForm.get('first_name')?.touched"
                        class="text-red-500">
                        Campo requerido.
                    </small>
                </div>

                <!-- Apellidos -->
                <div class="flex flex-col gap-2">
                    <label for="last_name" class="font-semibold text-gray-700">Apellidos</label>
                    <input pInputText id="last_name" formControlName="last_name" class="uppercase" />
                    <small *ngIf="userForm.get('last_name')?.invalid && userForm.get('last_name')?.touched"
                        class="text-red-500">
                        Campo requerido.
                    </small>
                </div>

                <!-- Dirección -->
                <div class="flex flex-col gap-2">
                    <label for="address" class="font-semibold text-gray-700">Dirección</label>
                    <input pInputText id="address" formControlName="address" />
                </div>

                <!-- Teléfono -->
                <div class="flex flex-col gap-2">
                    <label for="phone" class="font-semibold text-gray-700">Teléfono</label>
                    <input pInputText id="phone" formControlName="phone" />
                </div>
            </div>

            <!-- Botones -->
            <div class="flex justify-end gap-2 mt-4 pt-4 border-t border-gray-100">
                <p-button label="Cancelar" icon="pi pi-times" [text]="true" severity="secondary"
                    (click)="onCancel()"></p-button>
                <p-button label="Guardar" icon="pi pi-check" type="submit" severity="info"
                    [disabled]="userForm.invalid"></p-button>
            </div>
        </form>
    </p-dialog>
</div>